I am getting this error in databricks:
ypeError: StateGraph.add_node() got an unexpected keyword argument 'input_schema'

I am pinned to a version and it says this:

if you are pinned to an older version, you must use the matching code for that version, or remove any code paths that pass input_schema to add_node.

Here is my versions:

uri-template                             1.3.0
urllib3                                  2.3.0
uvicorn                                  0.34.2
uvloop                                   0.21.0
virtualenv                               20.29.3
wadllib                                  1.3.6
watchfiles                               1.1.0
wcwidth                                  0.2.5
webcolors                                24.11.1
webencodings                             0.5.1
websocket-client                         1.8.0
websockets                               15.0.1
whatthepatch                             1.0.2
wheel                                    0.45.1
widgetsnbextension                       3.6.6
wrapt                                    1.17.0
xxhash                                   3.5.0
yapf                                     0.40.2
yarl                                     1.20.1
zipp                                     3.21.0
zstandard                                0.23.0


import json
import pandas as pd
from datetime import datetime
from typing import Dict, Any
from langchain_openai import ChatOpenAI
from langchain_core.prompts import ChatPromptTemplate
from langchain_core.messages import HumanMessage, SystemMessage
from langchain_core.output_parsers import StrOutputParser
from langgraph.graph import StateGraph, MessagesState
from langgraph.prebuilt import ToolNode, tools_condition, create_react_agent
from langchain_core.tools import tool
from dateutil import parser
import os
os.environ["OPENAI_API_KEY"] = "sk-" + "ant" + "api" + "key"
# Starting directory (current working directory)
start_dir = '.'

# File name to search
target_file = 'reference_codes.json'

# Walk through directories and find matches
matches = []
for root, dirs, files in os.walk(start_dir):
    if target_file in files:
        matches.append(os.path.join(root, target_file))

if matches:
    print("Found the file at:")
    for match in matches:
        print(match)
else:
    print(f"'{target_file}' not found under {os.path.abspath(start_dir)}")

os.environ["OPENAI_API_KEY"] = "9b5ad71b2ce5302211f9c61530b329a4922fc6a4"

llm = ChatOpenAI(
    model="gpt-4o-mini",
    temperature=0
)

with open("./Data/reference_codes.json") as f:
    reference_codes = json.load(f)

with open("./Data/insurance_policies.json") as f:
    policies_raw = json.load(f)
    policy_dict = {p["policy_id"]: p for p in policies_raw}

with open("./Data/validation_records.json") as f:
    validation_records = json.load(f)

with open("./Data/test_records.json") as f:
    test_records = json.load(f)

# Add age to every record
def calc_age(dob, dos):
    b = datetime.strptime(dob, "%Y-%m-%d")
    s = datetime.strptime(dos, "%Y-%m-%d")
    age = s.year - b.year
    if (s.month, s.day) < (b.month, b.day):
        age -= 1
    return age

for recs in [validation_records, test_records]:
    for r in recs:
        r['age'] = calc_age(r['date_of_birth'], r['date_of_service'])

ref_str = json.dumps(reference_codes, indent=2)

@tool
def summarize_patient_record(record_str: str) -> str:
    """Create structured patient summary"""
    prompt = f"""You are an expert insurance summarizer.
Use these code descriptions (never make up codes):
ICD-10: {json.dumps({k:v for k,v in reference_codes.items() if not k.isdigit()}, ensure_ascii=False)}
CPT: {json.dumps({k:v for k,v in reference_codes.items() if k.isdigit()}, ensure_ascii=False)}

Return ONLY this exact format:

• Patient Demographics: [Name], [Gender], age [Age]
• Insurance Policy ID: [PolicyID]
• Diagnoses and Descriptions: [CODE] - [Description] (one per line)
• Procedures and Descriptions: [CODE] - [Description]
• Preauthorization Status: [Yes/No/Required but not obtained]
• Billed Amount (in USD): [Amount]
• Date of Service: [Date]

Patient record:
{record_str}"""
    return llm.invoke(prompt).content
@tool
def summarize_policy_guideline(policy_id: str) -> str:
    """Create structured policy summary"""
    policy = policy_dict.get(policy_id)
    if not policy:
        return "Policy not found"
    
    prompt = f"""You are an expert policy summarizer.
Use the reference codes below to expand CPT and ICD-10 codes.

Return ONLY this format:

• Policy Details: {policy_id} - {policy.get('plan_name','')}
• Covered Procedures:
{{for each procedure}}
  - Procedure Code and Description: [CPT] - [full description]
    Covered Diagnoses and Descriptions: [ICD1] - [desc1], [ICD2] - [desc2], ...
    Gender Restriction: {policy['covered_procedures'][i].get('gender','Any')}
    Age Range: {policy['covered_procedures'][i]['age_range'][0]} to {policy['covered_procedures'][i]['age_range'][1]} (inclusive min, exclusive max)
    Preauthorization Requirement: {'Yes' if policy['covered_procedures'][i].get('requires_preauthorization') else 'No'}
    Notes on Coverage: {policy['covered_procedures'][i].get('notes','None')}

Reference codes: {json.dumps(reference_codes, ensure_ascii=False)}"""
    return llm.invoke(prompt).content

@tool
def check_claim_coverage(record_summary: str, policy_summary: str) -> str:
    """
    Check claim coverage by comparing the record summary and policy summary using the LLM.
    """
    return llm.invoke(
        f"Check coverage:\nRecord:\n{record_summary}\nPolicy:\n{policy_summary}"
    ).content

tools = [summarize_patient_record, summarize_policy_guideline, check_claim_coverage]

system_prompt = """You are a Healthcare Insurance Claim Approval Agent.
Use the 3 tools in EXACT order:
1. summarize_patient_record (full JSON)
2. summarize_policy_guideline (policy_id)
3. check_claim_coverage (two summaries)
Then output ONLY:
Decision: APPROVE  or  Decision: ROUTE FOR REVIEW
Reason: short clear explanation with specific values
No extra text, no markdown."""

#agent = create_react_agent(llm, tools, messages_modifier=system_prompt)
create_react_agent(llm, tools=tools)
# @tool
# def check_claim_coverage(record_summary: str, policy_summary: str) -> str:
#     """Final coverage decision with reasoning"""
#     prompt = f"""You are a strict claims adjudicator.
# Approve ONLY if ALL these are true:
# - Procedure exactly matches a covered CPT
# - At least one diagnosis matches the allowed list for that CPT
# - Age >= min and < max (max exclusive)
# - Gender matches (Any = ok)
# - Preauth required → must be obtained

# Patient summary:
# {record_summary}

# Policy summary:
# {policy_summary}

# Return exactly these three sections:
# • Coverage Review: step-by-step pass/fail checks
# • Summary of Findings: bullets of passed/failed
# • Final Decision: APPROVE or ROUTE FOR REVIEW + one-sentence reason"""
#     return llm.invoke(prompt).content

# tools = [summarize_patient_record, summarize_policy_guideline, check_claim_coverage]
